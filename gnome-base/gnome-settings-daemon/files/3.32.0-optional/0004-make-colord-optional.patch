From 5b5e7190be0f8d5a1fbae8b8a87e8f2cdfec0f32 Mon Sep 17 00:00:00 2001
From: Poncho <poncho@spahan.ch>
Date: Sat, 17 Mar 2018 10:48:17 +0100
Subject: [PATCH 4/4] make colord optional

---
 meson.build         | 8 +++++++-
 meson_options.txt   | 1 +
 plugins/meson.build | 5 ++++-
 3 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/meson.build b/meson.build
index 17230a52..49154ac4 100644
--- a/meson.build
+++ b/meson.build
@@ -83,7 +83,6 @@ endif
 add_project_arguments(common_flags + compiler_flags, language: 'c')
 
 glib_dep = dependency('glib-2.0', version: '>= 2.56')
-colord_dep = dependency('colord', version: '>= 1.0.2')
 geocode_glib_dep = dependency('geocode-glib-1.0', version: '>= 3.10.0')
 gio_dep = dependency('gio-2.0', version: '>= 2.53.0')
 gio_unix_dep = dependency('gio-unix-2.0')
@@ -147,6 +146,12 @@ if enable_wacom
 endif
 config_h.set10('HAVE_WACOM', enable_wacom)
 
+# colord
+enable_colord = get_option('colord')
+if enable_colord
+  colord_dep = dependency('colord', version: '>= 1.0.2')
+endif
+
 # smartcard section
 enable_smartcard = get_option('smartcard')
 if enable_smartcard
@@ -240,6 +245,7 @@ output += '        Smartcard support:        ' + enable_smartcard.to_string() +
 output += '        Cups support:             ' + enable_cups.to_string() + '\n'
 output += '        Wayland support:          ' + enable_wayland.to_string() + '\n'
 output += '        Wacom support:            ' + enable_wacom.to_string() + '\n'
+output += '        Colord support:           ' + enable_colord.to_string() + '\n'
 output += '        RFKill support:           ' + enable_rfkill.to_string() + '\n'
 if enable_smartcard
   output += '        System nssdb:             ' + system_nssdb_dir + '\n'
diff --git a/meson_options.txt b/meson_options.txt
index 966add7c..24bdb971 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -9,3 +9,4 @@ option('rfkill', type: 'boolean', value: true, description: 'build with rfkill s
 option('smartcard', type: 'boolean', value: true, description: 'build with smartcard support')
 option('wayland', type: 'boolean', value: true, description: 'build with Wayland support')
 option('wacom', type: 'boolean', value: true, description: 'build with Wacom support')
+option('colord', type: 'boolean', value: true, description: 'build with colord support')
diff --git a/plugins/meson.build b/plugins/meson.build
index 3db69da7..50d50e4c 100644
--- a/plugins/meson.build
+++ b/plugins/meson.build
@@ -1,7 +1,6 @@
 enabled_plugins = [
   ['a11y-settings', 'A11ySettings'],
   ['clipboard', 'Clipboard'],
-  ['color', 'Color'],
   ['datetime', 'Datetime'],
   ['dummy', ''],
   ['power', 'Power'],
@@ -23,6 +22,10 @@ if enable_wacom
   enabled_plugins += [['wacom', 'Wacom']]
 endif
 
+if enable_colord
+  enabled_plugins += [['color', 'Color']]
+endif
+
 if enable_cups
   enabled_plugins += [['print-notifications', 'PrintNotifications']]
 endif
-- 
2.19.2

