From 66dc4a75641910d2c59422586613d8f1201c491e Mon Sep 17 00:00:00 2001
From: Poncho <poncho@spahan.ch>
Date: Sat, 17 Mar 2018 12:58:21 +0100
Subject: [PATCH 3/7] make networkmanager optional

---
 meson.build              | 11 ++++++-----
 meson_options.txt        |  1 +
 panels/meson.build       |  2 +-
 panels/power/meson.build |  2 +-
 4 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/meson.build b/meson.build
index 8335246bf..b285198fb 100644
--- a/meson.build
+++ b/meson.build
@@ -199,17 +199,18 @@ config_h.set10('HAVE_FN_EXPLICIT_BZERO',
                cc.has_function('explicit_bzero', prefix: '''#include <string.h>'''),
                description: 'Define if explicit_bzero is available')
 
-if host_is_linux
-  # network manager
+# network manager
+enable_network = get_option('network')
+if enable_network
   network_manager_deps = [
     dependency('libnm', version: '>= 1.10.0'),
     dependency('libnma', version: '>= 1.8.0'),
     dependency('mm-glib', version: '>= 0.7')
   ]
 endif
-config_h.set('BUILD_NETWORK', host_is_linux,
+config_h.set('BUILD_NETWORK', enable_network,
              description: 'Define to 1 to build the Network panel')
-config_h.set('HAVE_NETWORK_MANAGER', host_is_linux,
+config_h.set('HAVE_NETWORK_MANAGER', enable_network,
              description: 'Define to 1 if NetworkManager is available')
 
 # gnome-bluetooth
@@ -296,7 +297,7 @@ output += ' Panels \n'
 output += '     GNOME Bluetooth (Bluetooth panel) .......... ' + enable_bluetooth.to_string() + '\n'
 output += '     Cheese (Users panel webcam support) ........ ' + enable_cheese.to_string() + '\n'
 output += '     IBus (Region panel IBus support) ........... ' + enable_ibus.to_string() + '\n'
-output += '     NetworkManager (Network panel) ............. ' + host_is_linux.to_string() + '\n'
+output += '     NetworkManager (Network panel) ............. ' + enable_network.to_string() + '\n'
 output += '     Wacom (Wacom tablet panel) ................. ' + enable_wacom.to_string() + '\n'
 output += '     Wayland .................................... ' + enable_wayland.to_string() + '\n'
 
diff --git a/meson_options.txt b/meson_options.txt
index f80edddd7..ac5186228 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -6,3 +6,4 @@ option('tracing', type: 'boolean', value: false, description: 'add extra debuggi
 option('wayland', type: 'boolean', value: true, description: 'build with Wayland support')
 option('wacom', type: 'boolean', value: true, description: 'build with wacom support')
 option('bluetooth', type: 'boolean', value: true, description: 'build with gnome-bluetooth support')
+option('network', type: 'boolean', value: true, description: 'build with networkmanager support')
diff --git a/panels/meson.build b/panels/meson.build
index 7f1a6256a..9a0dc0d1f 100644
--- a/panels/meson.build
+++ b/panels/meson.build
@@ -26,7 +26,7 @@ if enable_wacom
   panels += ['wacom']
 endif
 
-if host_is_linux
+if enable_network
   panels += ['network']
 endif
 
diff --git a/panels/power/meson.build b/panels/power/meson.build
index c07a0234d..94cfdfce9 100644
--- a/panels/power/meson.build
+++ b/panels/power/meson.build
@@ -36,7 +36,7 @@ deps = common_deps + [
 
 cflags += '-DGNOMELOCALEDIR="@0@"'.format(control_center_localedir)
 
-if host_is_linux
+if enable_network
   deps += network_manager_deps
 endif
 
-- 
2.19.2

