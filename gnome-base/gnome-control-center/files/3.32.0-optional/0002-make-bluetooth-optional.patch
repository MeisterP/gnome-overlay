From ba0d9365e3a877540c84b64505154a6f7d462b7d Mon Sep 17 00:00:00 2001
From: Poncho <poncho@spahan.ch>
Date: Sat, 17 Mar 2018 12:45:39 +0100
Subject: [PATCH 2/7] make bluetooth optional

---
 meson.build              | 13 ++++++-------
 meson_options.txt        |  1 +
 panels/meson.build       |  9 +++++----
 panels/power/meson.build |  2 +-
 4 files changed, 13 insertions(+), 12 deletions(-)

diff --git a/meson.build b/meson.build
index 9fe1f5ccb..8335246bf 100644
--- a/meson.build
+++ b/meson.build
@@ -212,15 +212,14 @@ config_h.set('BUILD_NETWORK', host_is_linux,
 config_h.set('HAVE_NETWORK_MANAGER', host_is_linux,
              description: 'Define to 1 if NetworkManager is available')
 
-if host_is_linux_not_s390
-  # gnome-bluetooth
+# gnome-bluetooth
+enable_bluetooth = get_option('bluetooth')
+if enable_bluetooth
   gnome_bluetooth_dep = dependency('gnome-bluetooth-1.0', version: '>= 3.18.2')
-else
-  message('Bluetooth and Wacom panels will not be built (no USB support on this platform)')
 endif
-config_h.set('BUILD_BLUETOOTH', host_is_linux_not_s390,
+config_h.set('BUILD_BLUETOOTH', enable_bluetooth,
              description: 'Define to 1 to build the Bluetooth panel')
-config_h.set('HAVE_BLUETOOTH', host_is_linux_not_s390,
+config_h.set('HAVE_BLUETOOTH', enable_bluetooth,
              description: 'Define to 1 if bluetooth support is available')
 
 # Wacom panel
@@ -294,7 +293,7 @@ output += '     Tracing .................................... ' + enable_tracing.
 output += '     gnome-session libexecdir ................... ' + gnome_session_libexecdir + '\n'
 output += '     Optimized .................................. ' + control_center_optimized.to_string() + '\n'
 output += ' Panels \n'
-output += '     GNOME Bluetooth (Bluetooth panel) .......... ' + host_is_linux_not_s390.to_string() + '\n'
+output += '     GNOME Bluetooth (Bluetooth panel) .......... ' + enable_bluetooth.to_string() + '\n'
 output += '     Cheese (Users panel webcam support) ........ ' + enable_cheese.to_string() + '\n'
 output += '     IBus (Region panel IBus support) ........... ' + enable_ibus.to_string() + '\n'
 output += '     NetworkManager (Network panel) ............. ' + host_is_linux.to_string() + '\n'
diff --git a/meson_options.txt b/meson_options.txt
index 28e214c36..f80edddd7 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -5,3 +5,4 @@ option('ibus', type: 'boolean', value: true, description: 'build with IBus suppo
 option('tracing', type: 'boolean', value: false, description: 'add extra debugging information')
 option('wayland', type: 'boolean', value: true, description: 'build with Wayland support')
 option('wacom', type: 'boolean', value: true, description: 'build with wacom support')
+option('bluetooth', type: 'boolean', value: true, description: 'build with gnome-bluetooth support')
diff --git a/panels/meson.build b/panels/meson.build
index c5ca625b5..7f1a6256a 100644
--- a/panels/meson.build
+++ b/panels/meson.build
@@ -31,10 +31,11 @@ if host_is_linux
 endif
 
 if host_is_linux_not_s390
-  panels += [
-    'bluetooth',
-    'thunderbolt',
-  ]
+  panels += ['thunderbolt']
+endif
+
+if enable_bluetooth
+  panels += ['bluetooth']
 endif
 
 panels_list = []
diff --git a/panels/power/meson.build b/panels/power/meson.build
index 736222613..c07a0234d 100644
--- a/panels/power/meson.build
+++ b/panels/power/meson.build
@@ -40,7 +40,7 @@ if host_is_linux
   deps += network_manager_deps
 endif
 
-if host_is_linux_not_s390
+if enable_bluetooth
   deps += gnome_bluetooth_dep
 endif
 
-- 
2.19.2

