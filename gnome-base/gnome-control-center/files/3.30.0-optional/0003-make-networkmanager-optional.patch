From 963d112773950d30ed4c39d60ae8ba7df05ca772 Mon Sep 17 00:00:00 2001
From: Poncho <poncho@spahan.ch>
Date: Sat, 17 Mar 2018 12:58:21 +0100
Subject: [PATCH 3/3] make networkmanager optional

---
 meson.build              | 11 ++++++-----
 meson_options.txt        |  1 +
 panels/meson.build       |  2 +-
 panels/power/meson.build |  2 +-
 4 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/meson.build b/meson.build
index c1fa21dd8..c10869d3f 100644
--- a/meson.build
+++ b/meson.build
@@ -181,17 +181,18 @@ endif
 config_h.set('HAVE_WAYLAND', enable_wayland,
              description: 'Define to 1 if Wayland is enabled')
 
-if host_is_linux
-  # network manager
+# network manager
+enable_network = get_option('network')
+if enable_network
   network_manager_deps = [
     dependency('libnm', version: '>= 1.10.0'),
     dependency('libnma', version: '>= 1.8.0'),
     dependency('mm-glib', version: '>= 0.7')
   ]
 endif
-config_h.set('BUILD_NETWORK', host_is_linux,
+config_h.set('BUILD_NETWORK', enable_network,
              description: 'Define to 1 to build the Network panel')
-config_h.set('HAVE_NETWORK_MANAGER', host_is_linux,
+config_h.set('HAVE_NETWORK_MANAGER', enable_network,
              description: 'Define to 1 if NetworkManager is available')
 
 # gnome-bluetooth
@@ -282,7 +283,7 @@ output += ' Panels \n'
 output += '     GNOME Bluetooth (Bluetooth panel) .......... ' + enable_bluetooth.to_string() + '\n'
 output += '     Cheese (Users panel webcam support) ........ ' + enable_cheese.to_string() + '\n'
 output += '     IBus (Region panel IBus support) ........... ' + enable_ibus.to_string() + '\n'
-output += '     NetworkManager (Network panel) ............. ' + host_is_linux.to_string() + '\n'
+output += '     NetworkManager (Network panel) ............. ' + enable_network.to_string() + '\n'
 output += '     Wacom (Wacom tablet panel) ................. ' + enable_wacom.to_string() + '\n'
 output += '     Wayland .................................... ' + enable_wayland.to_string() + '\n'
 
diff --git a/meson_options.txt b/meson_options.txt
index f80edddd7..ac5186228 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -6,3 +6,4 @@ option('tracing', type: 'boolean', value: false, description: 'add extra debuggi
 option('wayland', type: 'boolean', value: true, description: 'build with Wayland support')
 option('wacom', type: 'boolean', value: true, description: 'build with wacom support')
 option('bluetooth', type: 'boolean', value: true, description: 'build with gnome-bluetooth support')
+option('network', type: 'boolean', value: true, description: 'build with networkmanager support')
diff --git a/panels/meson.build b/panels/meson.build
index 7ecab5abe..5cf6b1640 100644
--- a/panels/meson.build
+++ b/panels/meson.build
@@ -25,7 +25,7 @@ if enable_wacom
   panels += ['wacom']
 endif
 
-if host_is_linux
+if enable_network
   panels += ['network']
 endif
 
diff --git a/panels/power/meson.build b/panels/power/meson.build
index edc088e05..659e02257 100644
--- a/panels/power/meson.build
+++ b/panels/power/meson.build
@@ -36,7 +36,7 @@ deps = common_deps + [
 
 cflags += '-DGNOMELOCALEDIR="@0@"'.format(control_center_localedir)
 
-if host_is_linux
+if enable_network
   deps += network_manager_deps
 endif
 
-- 
2.16.4

