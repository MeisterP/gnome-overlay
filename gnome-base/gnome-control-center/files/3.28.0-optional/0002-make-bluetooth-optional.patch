From 313a2d7dd9011856bb9a098e8aca197ea8e3e2e8 Mon Sep 17 00:00:00 2001
From: Poncho <poncho@spahan.ch>
Date: Sat, 17 Mar 2018 12:45:39 +0100
Subject: [PATCH 2/3] make bluetooth optional

---
 meson.build              | 13 ++++++-------
 meson_options.txt        |  1 +
 panels/meson.build       |  2 +-
 panels/power/meson.build |  2 +-
 4 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/meson.build b/meson.build
index 18ff55fff..465c4abba 100644
--- a/meson.build
+++ b/meson.build
@@ -199,15 +199,14 @@ config_h.set('BUILD_NETWORK', host_is_linux,
 config_h.set('HAVE_NETWORK_MANAGER', host_is_linux,
              description: 'Define to 1 if NetworkManager is available')
 
-if host_is_linux_not_s390
-  # gnome-bluetooth
+# gnome-bluetooth
+enable_bluetooth = get_option('bluetooth')
+if enable_bluetooth
   gnome_bluetooth_dep = dependency('gnome-bluetooth-1.0', version: '>= 3.18.2')
-else
-  message('Bluetooth and Wacom panels will not be built (no USB support on this platform)')
 endif
-config_h.set('BUILD_BLUETOOTH', host_is_linux_not_s390,
+config_h.set('BUILD_BLUETOOTH', enable_bluetooth,
              description: 'Define to 1 to build the Bluetooth panel')
-config_h.set('HAVE_BLUETOOTH', host_is_linux_not_s390,
+config_h.set('HAVE_BLUETOOTH', enable_bluetooth,
              description: 'Define to 1 if bluetooth support is available')
 
 
@@ -280,7 +279,7 @@ meson.add_install_script(
 )
 
 output = meson.project_name() + ' was configured with the following options:\n'
-output += '** gnome-bluetooth (Bluetooth panel): ' + host_is_linux_not_s390.to_string() + '\n'
+output += '** gnome-bluetooth (Bluetooth panel): ' + enable_bluetooth.to_string() + '\n'
 output += '** Cheese (Users panel webcam support): ' + enable_cheese.to_string() + '\n'
 output += '** IBus (Region panel IBus support): ' + enable_ibus.to_string() + '\n'
 output += '** NetworkManager (Network panel): ' + host_is_linux.to_string() + '\n'
diff --git a/meson_options.txt b/meson_options.txt
index 2da13003b..608e8121a 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -4,4 +4,5 @@ option('gnome_session_libexecdir', type: 'string', value: '', description: 'Dire
 option('ibus', type: 'boolean', value: true, description: 'build with IBus support')
 option('wayland', type: 'boolean', value: true, description: 'build with Wayland support')
 option('wacom', type: 'boolean', value: true, description: 'build with wacom support')
+option('bluetooth', type: 'boolean', value: true, description: 'build with gnome-bluetooth support')
 
diff --git a/panels/meson.build b/panels/meson.build
index 6bb0cb778..0de00baa3 100644
--- a/panels/meson.build
+++ b/panels/meson.build
@@ -29,7 +29,7 @@ if host_is_linux
   panels += ['network']
 endif
 
-if host_is_linux_not_s390
+if enable_bluetooth
   panels += ['bluetooth']
 endif
 
diff --git a/panels/power/meson.build b/panels/power/meson.build
index 9a27e93bd..22f3fbf55 100644
--- a/panels/power/meson.build
+++ b/panels/power/meson.build
@@ -40,7 +40,7 @@ if host_is_linux
   deps += network_manager_deps
 endif
 
-if host_is_linux_not_s390
+if enable_bluetooth
   deps += gnome_bluetooth_dep
 endif
 
-- 
2.16.1

