From b29e393c5adc8ac1d4532f831299da42702edfcb Mon Sep 17 00:00:00 2001
From: Poncho <poncho@spahan.ch>
Date: Fri, 16 Mar 2018 19:16:17 +0100
Subject: [PATCH 1/3] make wacom optional

---
 meson.build        | 24 ++++++++++++++----------
 meson_options.txt  |  2 ++
 panels/meson.build |  9 +++++----
 shell/meson.build  |  2 +-
 4 files changed, 22 insertions(+), 15 deletions(-)

diff --git a/meson.build b/meson.build
index 2d0d45e83..18ff55fff 100644
--- a/meson.build
+++ b/meson.build
@@ -202,8 +202,18 @@ config_h.set('HAVE_NETWORK_MANAGER', host_is_linux,
 if host_is_linux_not_s390
   # gnome-bluetooth
   gnome_bluetooth_dep = dependency('gnome-bluetooth-1.0', version: '>= 3.18.2')
+else
+  message('Bluetooth and Wacom panels will not be built (no USB support on this platform)')
+endif
+config_h.set('BUILD_BLUETOOTH', host_is_linux_not_s390,
+             description: 'Define to 1 to build the Bluetooth panel')
+config_h.set('HAVE_BLUETOOTH', host_is_linux_not_s390,
+             description: 'Define to 1 if bluetooth support is available')
 
-  # Wacom
+
+# Wacom panel
+enable_wacom = get_option('wacom')
+if enable_wacom
   assert(clutter_gtk_dep.found(), 'clutter-gtk library is required for wacom support, but is not available.')
 
   libwacom_dep = dependency('libwacom', version: '>= 0.7')
@@ -215,16 +225,10 @@ if host_is_linux_not_s390
   ]
   config_h.set('HAVE_WACOM_3D_STYLUS', libwacom_dep.version().version_compare('>= 0.27'),
                description: 'Define to 1 if libwacom provides definition for 3D styli')
-else
-  message('Bluetooth and Wacom panels will not be built (no USB support on this platform)')
 endif
-config_h.set('BUILD_BLUETOOTH', host_is_linux_not_s390,
-             description: 'Define to 1 to build the Bluetooth panel')
-config_h.set('HAVE_BLUETOOTH', host_is_linux_not_s390,
-             description: 'Define to 1 if bluetooth support is available')
-config_h.set('BUILD_WACOM', host_is_linux_not_s390,
+config_h.set('BUILD_WACOM', enable_wacom,
              description: 'Define to 1 to build the Wacom panel')
-config_h.set('HAVE_WACOM', host_is_linux_not_s390,
+config_h.set('HAVE_WACOM', enable_wacom,
              description: 'Define to 1 if Wacom is supportted')
 
 # Check for info panel
@@ -280,7 +284,7 @@ output += '** gnome-bluetooth (Bluetooth panel): ' + host_is_linux_not_s390.to_s
 output += '** Cheese (Users panel webcam support): ' + enable_cheese.to_string() + '\n'
 output += '** IBus (Region panel IBus support): ' + enable_ibus.to_string() + '\n'
 output += '** NetworkManager (Network panel): ' + host_is_linux.to_string() + '\n'
-output += '** wacom (Wacom tablet panel): ' + host_is_linux_not_s390.to_string() + '\n'
+output += '** wacom (Wacom tablet panel): ' + enable_wacom.to_string() + '\n'
 output += '** Wayland: ' + enable_wayland.to_string() + '\n'
 output += '** gnome-session libexecdir: ' + gnome_session_libexecdir + '\n'
 output += 'End options'
diff --git a/meson_options.txt b/meson_options.txt
index 7498af4d6..2da13003b 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -3,3 +3,5 @@ option('documentation', type: 'boolean', value: false, description: 'build docum
 option('gnome_session_libexecdir', type: 'string', value: '', description: 'Directory for gnome-session\'s libexecdir')
 option('ibus', type: 'boolean', value: true, description: 'build with IBus support')
 option('wayland', type: 'boolean', value: true, description: 'build with Wayland support')
+option('wacom', type: 'boolean', value: true, description: 'build with wacom support')
+
diff --git a/panels/meson.build b/panels/meson.build
index d671c4775..6bb0cb778 100644
--- a/panels/meson.build
+++ b/panels/meson.build
@@ -21,15 +21,16 @@ panels = [
   'user-accounts'
 ]
 
+if enable_wacom
+  panels += ['wacom']
+endif
+
 if host_is_linux
   panels += ['network']
 endif
 
 if host_is_linux_not_s390
-  panels += [
-    'bluetooth',
-    'wacom'
-  ]
+  panels += ['bluetooth']
 endif
 
 panels_list = []
diff --git a/shell/meson.build b/shell/meson.build
index ea0116542..2f7ab645d 100644
--- a/shell/meson.build
+++ b/shell/meson.build
@@ -87,7 +87,7 @@ if enable_cheese
   shell_deps += cheese_deps
 endif
 
-if host_is_linux_not_s390
+if enable_wacom
   shell_deps += wacom_deps
 endif
 
-- 
2.16.1

